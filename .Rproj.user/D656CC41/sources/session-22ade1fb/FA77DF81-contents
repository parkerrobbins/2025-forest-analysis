---
title: "Random Forest"
author: "Parker T. Robbins"
date: "`r format(Sys.Date(), '%d %B %Y')`" 
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = dirname(rstudioapi::getActiveDocumentContext()$path))
library(tidyverse)
library(partykit)
library(moreparty)
data <- readRDS("../../data/preprocessed_data.rds") %>%  
    mutate(across(
    c(gender, lemma_category, lemma_taxonomy, local_zikh,
      match_in_prev_turn, match_in_turn, possessor_person_category,
      preposition_contracted, preposition_is_mit, region,
      with_preposition, yearofbirth),
    ~ replace_na(.x, "no")
  )) %>% 
   mutate(across(where(is.character), as.factor)) 
```


```{r random-forest}

set.seed(7501)

data_cf <-  partykit::cforest(
  category ~ gender + lemma_category + possessor_person_category + region +
    with_preposition + yearofbirth,
  data = data,
  ntree = 128
) 

saveRDS(data_cf, "../../data/data_cf.rds")

imp <- partykit::varimp(object = data_cf, conditional=TRUE)

saveRDS(data_cf, "../../data/imp.rds")
ggVarImp(imp, sort=TRUE, xlabel="Importance", ylabel="Variable", main="")

```